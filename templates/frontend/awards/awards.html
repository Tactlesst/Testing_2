{% extends 'layout.html' %}
{% load frontend_tags %}
{% load static %}
{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'css/adjustments.css' %}">
<style>
	.grid-xx {
	  	clear: both;
	  	margin-bottom: 0px;
	  	margin-top: 0px;
	  	padding: 0;
	}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
	<div class="row px-3 pt-3">
		<div class="col-lg-8">
			<h1 class="font-weight-bold">{{ tab_title }}</h1>
			<ol class="breadcrumb bg-transparent p-0">
				<li class="breadcrumb-item">
					<a href="{% url 'backend-dashboard' %}">Home</a>
				</li>
				<li class="breadcrumb-item">
					{{ tab_parent }}
				</li>
				<li class="breadcrumb-item active">
					<strong>{{ tab_title }}</strong>
				</li>
			</ol>
		</div>
	</div>
</div>
<div class="content-wrapper p-4 ml-0">
	<div class="row">
		<div class="col-md-9">
			<div id="view-awards-content"></div>
		</div>
		<div class="col-md-3">
			<div class="card">
				<div class="card-header bg-info">
					<h5 class="card-title font-weight-bold">FILTER</h5>
				</div>
				<div class="card-body">
					<div class="form-group">
						<h4>By Year</h4>
						<div class="input-group">
							<input type="number" class="form-control" id="year" value="{{ year }}">
							<div class="input-group-append">
								<button type="button" class="btn btn-info" id="btn-search">Search</button>
							</div>
						</div>
					</div>
					<div class="form-group" style="margin-bottom:5px;">
						<h4>By Category</h4>
						<select class="form-control select" id="category">
							<option value="all">All</option>
							{% for category in categories %}
								<option value="{{ category.id }}">{{ category.name }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
			</div>
			<div class="card">
				<div class="card-header bg-info">
					<h5 class="card-title font-weight-bold">DOWNLOAD GUIDELINES</h5>
				</div>
				<div class="card-body">
					<div id="guidelines-content"></div>
				</div>
			</div>
			<div class="card latest-nominations">
				<div class="card-header bg-info">
					<h5 class="card-title font-weight-bold">LATEST NOMINATIONS</h5>
				</div>
				<div class="card-body">
					<div id="latest-nominations"></div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="modal" id="edit-modal" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
	<div class="modal-dialog modal-xl">
		<div class="modal-content animated bounceInDown">
			<div class="modal-header bg-info">
				<h3 class="modal-title">
					VIEW CATEGORY AND NOMINEES
				</h3>
				<button type="button" class="close text-white" data-dismiss="modal"><span aria-hidden="true">Ã—</span><span class="sr-only">Close</span></button>
			</div>
	        <div class="modal-body"></div>
			<div class="modal-footer" id="modal-footer">
				<div class="modal-footer-xd"></div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
	$(document).ready(function(){
		loadData();

		function loadData(){
			$('#view-awards-content').load('/awards/view/' + $('#year').val() + '/' + $('#category').val(), function() {
                $(document).off('click', 'a[data-role=mark-as-winner]').on('click', 'a[data-role=mark-as-winner]', function() {
                    var id = $(this).data('id');

                    $.ajax({
                        url: '{% url "nomination_mark_as_winners" %}',
                        type: 'POST',
                        data: {
                            id: id
                        },
                        success: function(response) {
                            if(response.success) {
                                $(`#markAsWinnerContent-${id}`).html(`
                                    <i class="fas fa-trophy text-warning"></i>
                                    &nbsp;<a class="text-danger" href="javascript:void(0);" data-role="unmark-as-winner" data-id="${id}">Remove</a>
                                `);
                            }
                        }
                    })
                });

                $(document).off('click', 'a[data-role=unmark-as-winner]').on('click', 'a[data-role=unmark-as-winner]', function() {
                    var id = $(this).data('id');

                    $.ajax({
                        url: '{% url "nomination_unmark_as_winners" %}',
                        type: 'POST',
                        data: {
                            id: id
                        },
                        success: function(response) {
                            if(response.success) {
                                $(`#markAsWinnerContent-${id}`).html(`
                                    <a href="javascript:void(0);" class="text-info" data-role="mark-as-winner" data-id="${id}" style="margin-top:3px">
                                        <i class="fas fa-trophy text-info"></i>
                                    </a>
                                `);
                            }
                        }
                    })
                });
            });

			$.get({
				url: '/awards/guidelines/get/' + $('#year').val(),
				success: function(response) {
					if (response.guidelines && response.guidelines.length > 0) {
						let filesHtml = '';
						response.guidelines.forEach(file => {
							filesHtml += `
								<p>
									<a href="${file.file}" target="_blank" class="text-info">
										<i class="far fa-file-pdf"></i> ${file.title}
									</a>
								</p>
							`;
						});
						$('#guidelines-content').html(filesHtml);
					} else {
						$('#guidelines-content').html(response.msg);
					}
				}
			});
		}

		$('#btn-search').on('click', function(){
			loadData();
		});

		function callAwardPage(pageRefInput) {
			$.ajax({
				url: pageRefInput,
				type: "GET",
				dataType: 'text',
				beforeSend: function() {
					$('#view-awards-content').empty();
					$('#view-awards-content').append('<div class="spinner-example" id="preloader"><div class="sk-spinner sk-spinner-double-bounce"><div class="sk-double-bounce1"></div><div class="sk-double-bounce2"></div></div><br><p class="text-center">Loading..</p></div>');
				},
				success: function(response) {
					$('#view-awards-content').html(response);
				},
				complete: function() {
					$('#preloader').css('display', 'none');
				}
			});
    	}
	});
</script>
{% endblock %}
